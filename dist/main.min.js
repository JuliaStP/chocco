// NATIVE JS ///////////////////////////////////////////////////////
// function Accord(selector) {
//   const accord = document.querySelector(selector);
//   const items = accord.querySelector('[data-list]').children;
//   const closeButton = document.querySelector('.accord__btn');
  
//   accord.addEventListener('click', function(e) {
//     e.preventDefault ();
//     const target = e.target.closest('[data]');

//     if(!target) return;

//     const item = target.parentNode;
    
//     if (item.classList.contains('item-active')) {
//       item.classList.remove('item-active');
//     }else {
//       for (let i = 0; i < items.length; i++) {
//         items[i].classList.remove('item-active');
//       }
//       item.classList.add('item-active');
//     }

//     closeButton.addEventListener('click', e => {
//       e.preventDefault();
//       item.classList.remove('item-active');
//     });
//   });
// };

// new Accord ('#accord-menu');

// JQUERY ///////////////////////////////////////////////////////
const mesureWidth = itemAc => {

    let reqItemWidth = 0;
  
    const screenWidth = $(window).width();
    const containerAc = itemAc.closest('.accord');
    const titleBlocks = containerAc.find('.accord__link');
    
  
    const textContainer = itemAc.find('.accord__text');
    const paddingLeft = parseInt(textContainer.css('padding-left'));
    const paddingRight = parseInt(textContainer.css('padding-right'));
  
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    const isSmallMobile = window.matchMedia('(max-width: 480px)').matches;
  
    const titleWidth = isSmallMobile ? titleBlocks.width() : titleBlocks.width() * titleBlocks.length;
    if(isMobile) {
      reqItemWidth = screenWidth - titleWidth;
    } else {
      reqItemWidth = 500;
    }
  
    if(isSmallMobile) {
      reqItemWidth = screenWidth - titleWidth;
    } else {
      reqItemWidth = 500;
    }
  
    return {
      container: reqItemWidth,
      textContainer: reqItemWidth - paddingLeft - paddingRight
    }
  };
  
  const closeItem = (container) => {
    const itemsAc = container.find('.accord__item');
    const content = container.find('.accord__content');
  
    itemsAc.removeClass('item-active');
    content.width(0);
  }
  
  const openItem = (itemAc) => {
    const hiddenContent = itemAc.find('.accord__content');
    const reqWidth = mesureWidth(itemAc);
    const textBlock = itemAc.find('.accord__text');
  
    itemAc.addClass('item-active');
    hiddenContent.width(reqWidth.container);
    textBlock.width(reqWidth.textContainer);
  };
  
  $('.accord__link').on('click', (e) => {
    e.preventDefault();
  
    const $this = $(e.currentTarget);
    const itemAc = $this.closest('.accord__item');
    const itemOpened = itemAc.hasClass('item-active');
    const container = $this.closest('.accord');
  
    if(itemOpened) {
      closeItem(container);
    } else {
      closeItem(container);
      openItem(itemAc);
    }
  });
  
  $('.accord__btn').on('click', e => {
    e.preventDefault();
  
    closeItem($('.accord'));
  });;const burgerBtn = document.querySelector('#burger');
const hamburger = document.querySelector('.hamburger');
const closeBtn = document.querySelector('.hamburger__btn');

function switcher(elem, className) {
  elem.classList.toggle(className);
}

let flag = true;

burgerBtn.addEventListener('click', e => {
  e.preventDefault();
  
  if(flag) {
    flag = false;
    hamburger.classList.remove('hidden');
    setTimeout(function() {
      switcher(hamburger, 'isActive');
      flag = true;
    }, 500);
  }
});

closeBtn.addEventListener('click', e => {
  e.preventDefault();

  if(flag) {
    flag = false;
    hamburger.classList.remove('isActive');
    setTimeout(function() {
      switcher(hamburger, 'hidden');
      flag = true;
  }, 500);
  }
  
});;const validateFields = (form, fieldsArray) => {

    fieldsArray.forEach((field) => {
      field.removeClass('input-error');
      if(field.val().trim() === '') {
        field.addClass('input-error')
      }
    });
  
    const errorFields = form.find('.input-error');
  
    return errorFields.length === 0;
  }
  
  
  $('.form').submit(e => {
    e.preventDefault();
  
    const form = $(e.currentTarget);
    const name = form.find("[name='name']");
    const phone = form.find("[name='phone']");
    const comment = form.find("[name='comment']");
    const to = form.find("[name='to']");
  
    const popup = $('#popup');
    const content = popup.find('.popup__text');
    popup.removeClass('error-popup');
  
    const isValid = validateFields(form, [name, phone, comment, to]);
  
    if (isValid) {
      const request = $.ajax({
        url:'https://webdev-api.loftschool.com/sendmail', 
        method: 'post',
        data: {
          name: name.val(),
          phone: phone.val(),
          comment: comment.val(),
          to: to.val(),
        },
        error: data => {}
      });
  
      request.done(data => {
        content.text(data.message);
      });
  
      request.fail(data => {
        const message = data.responseJSON.message;
          content.text(message);
          popup.addClass('error-popup'); 
      });
  
      request.always(() => {
        $.fancybox.open({
          src: '#popup',
          type: 'inline',
        });
      })
    }
  });
  
  $('.js-btn-submit').click(e => {
    e.preventDefault();
  
    $.fancybox.close();
  });
  ;// BURGER MENU /////////////////////////////////////////////



// TEAM //////////////////////////////////////////////////



//SLIDER/////////////////////////////////////////////////////////////////




// REVIEWS ///////////////////////////////////////////////


// FORM /////////////////////////////////////////////


// ACCORD //////////////////////////////////////////////////////////


// VIDEO //////////////////////////////////////////////////////



// MAP ///////////////////////////////////////////////////////////



// ONEPAGE SCROLL ////////////////////////////////////////////////////

;function init() {
    const myMap = new ymaps.Map('map', {
      center: [55.749410, 37.601060],
      zoom: 14,
      controls: []
        });
    
        myCollection = new ymaps.GeoObjectCollection({}, {
          draggable: false,
          iconLayout: 'default#image',
          iconImageHref: './img/icons/marker.svg',
          iconImageSize: [46, 57],
          iconImageOffset: [-35, -52]
        });
    
        myPoints = [
            { coords: [55.749798, 37.605695], text: 'CHOCCO Первый магазин' },
            { coords: [55.758729, 37.583145], text: 'CHOCCO Второй магазин' },
            { coords: [55.742804, 37.580576], text: 'CHOCCO Третий магазин' },
            { coords: [55.757064, 37.622157], text: 'CHOCCO Четвертый магазин'} 
        ];
  
    for (let i = 0, l = myPoints.length; i < l; i++) {
        let point = myPoints[i];
        myCollection.add(new ymaps.Placemark(
            point.coords, {
                balloonContentBody: point.text
            }
        ));
    }
  
    myMap.geoObjects.add(myCollection);
  
    const mySearchControl = new ymaps.control.SearchControl({
        options: {
            provider: new CustomSearchProvider(myPoints),
            noPlacemark: true,
            resultsPerPage: 4
        }});
  }
  
  function CustomSearchProvider(points) {
    this.points = points;
  }
  
  
  CustomSearchProvider.prototype.geocode = function (request, options) {
    const deferred = new ymaps.vow.defer(),
        geoObjects = new ymaps.GeoObjectCollection(),
        offset = options.skip || 0,
        limit = options.results || 4;
        
    const points = [];
    for (let i = 0, l = this.points.length; i < l; i++) {
        let point = this.points[i];
        if (point.text.toLowerCase().indexOf(request.toLowerCase()) != -1) {
            points.push(point);
        }
    }
    points = points.splice(offset, limit);
    for (let i = 0, l = points.length; i < l; i++) {
        let point = points[i],
            coords = point.coords,
                    text = point.text;
  
        geoObjects.add(new ymaps.Placemark(coords, {
            name: text + ' name',
            description: text + ' description',
            balloonContentBody: '<p>' + text + '</p>',
            boundedBy: [coords, coords]
        }));
    }
  
    deferred.resolve({
        geoObjects: geoObjects,
        metaData: {
            geocoder: {
                request: request,
                found: geoObjects.getLength(),
                results: limit,
                skip: offset
            }
        }
    });
  
    return deferred.promise();
  };
  
  ymaps.ready(init);;const sections = $('section');
const display = $('.maincontent');
const sideMenu = $('.dots-menu');
const menuItems = sideMenu.find('.dots-menu__item');

const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

let inScroll = false;

sections.first().addClass('active-sect');

const countSection = (sectionEq) => {
  const position = sectionEq * -100;
  
  if(isNaN(position)) {
    console.error('incorrect value in countSection');
    return 0;
  }
  return position;
}

const changeMenuColor = sectionEq => {
      const currentSection = sections.eq(sectionEq);
      const menuColor = currentSection.attr('data-dotsmenu-color');
      const activeClass = 'dots-menu--dark';

      if(menuColor === 'dark') {
        sideMenu.addClass(activeClass);
      } else {
        sideMenu.removeClass(activeClass);
      }
};

const resetActiveClass = (items, itemEq, activeClass) => {
  items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
};

const performTrans = (sectionEq) => {

  if(inScroll) return;

  const transitionOver = 1000;
  const mouseOver = 300;

    inScroll = true;

    const position = countSection(sectionEq);

    changeMenuColor(sectionEq);

    display.css({
      transform: `translateY(${position}%)`
    });

    resetActiveClass(sections, sectionEq, 'active-sect');

    setTimeout(() => {
      inScroll = false;
      resetActiveClass(menuItems, sectionEq, 'dots-menu__item--active');
    }, transitionOver + mouseOver);
};

const scroll = () => {
  const activeSection = sections.filter('.active-sect');
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  return {
    next() {
      if(nextSection.length) {
        performTrans(nextSection.index());
      }
    },
    prev() {
      if(prevSection.length) {
        performTrans(prevSection.index());
      }
    },
  };
};

$(window).on('wheel', e => {
  const deltaY = e.originalEvent.deltaY;
  const scroller = scroll();

  if (deltaY > 0) {
    scroller.next();
  }
  
  if (deltaY < 0) {
    scroller.prev();
  }
});

$(window).on('keydown', e => {
  const tagName = e.target.tagName.toLowerCase();
  const typingInputs = tagName ==='input' || tagName === 'textarea';
  const scroller = scroll();

  if (typingInputs) return;

    switch (e.keyCode) {
      case 38:
        scroller.prev();
      break;
  
      case 40:
        scroller.next();
      break;
    }
});

$('.wrapper').on('touchmove', e => e.preventDefault());

$('[data-scroll-to]').click(e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr('data-scroll-to');
  const reqSection = $(`[data-section-id=${target}]`);
  $('.hamburger').addClass('hidden');

  performTrans(reqSection.index());
});

// PHONES ////////////////////////////////////////////
if (isMobile) {
  $('body').swipe({
    swipe: function(event, direction) {
      const scroller = scroll();
      let scrollDirection = '';
  
      if (direction === 'up') scrollDirection = 'next';
      if (direction === 'down') scrollDirection = 'prev';
      
      scroller[scrollDirection]();
    },
  });
};;// JQuerry////////////////////////////////////////////////
// const findBlockByAlias = (alias) => {
//   return $('.review__container').filter((ndx, item) => {
//     return $(item).attr('data-linked-with') == alias;
//   });
// };

// $('.avatar-menu__link').click((e) => {
//   e.preventDefault();

//   const $this = $(e.currentTarget);
//   const target = $this.attr('data-open');
//   const itemToShow = findBlockByAlias(target);
//   const curItem = $this.closest('.avatar-menu');

//   itemToShow.addClass('active').siblings().removeClass('active');
//   curItem.addClass('active').siblings().removeClass('active');
// });

// NATIVE JS////////////////////////////////////////////////
const reviewBtn = document.querySelectorAll('.avatar-menu');
const reviewTabs = document.querySelectorAll('.review__container');

for (let i=0; i<reviewBtn.length; i++) {
  reviewBtn[i].addEventListener('click', function (e) {
    e.preventDefault();
    for (let index=0; index<reviewBtn.length; index++) {
      reviewBtn[index].classList.remove('active')
      reviewTabs[index].classList.remove ('active')
    };
    e.currentTarget.classList.add('active');
    reviewTabs[i].classList.add('active');
  });
};const slider = $('.goods-list').bxSlider({
    pager: false,
    controls: false
  });
  
  $('.arrow__link--left').click(e => {
    e.preventDefault();
    slider.goToPrevSlide();
  })
  
  $('.arrow__link--right').click(e => {
    e.preventDefault();
    slider.goToNextSlide();
  });const team = document.querySelector('.team');
const teamLink = document.querySelector('.team__link');

team.addEventListener('click', e => {
  e.preventDefault();
  const link = e.target;
  const listItem = e.currentTarget;

  if(link.classList.contains('team__link')) {
    const active = listItem.querySelector('.team__item.team__item--is-active');
    console.log(active);

    if(active) {
      let activeInfo = active.querySelector('.team__info');
      activeInfo.style.height = '0px';
      active.classList.remove('team__item--is-active');
    }

    if(!active || active.querySelector('.team__link') !== link) {
              let current = link.closest('.team__item');
              current.classList.add('team__item--is-active');
              let currentText = current.querySelector('.team__info');
              currentText.style.height = currentText.scrollHeight + 'px';
  }
}
});;const player = document.querySelector('.video__player');
const video = document.querySelector('.video__mp4');
const juice = document.querySelector('.video__playback-btn');
const playBtn = document.getElementById('play-pause');
const seekTooltip = document.getElementById('seek-tooltip');

const progressBar = document.getElementById('progress-bar');
const seek = document.getElementById('seek');



function togglePlayPause() {
  if(video.paused) {
    playBtn.className = 'pause';
    video.play();
  }
  else {
    playBtn.className = 'play';
    video.pause();
  }
};

playBtn.onclick = function () {
  togglePlayPause();
};

player.addEventListener('click', togglePlayPause);

function formatTime(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = Math.round(seconds % 60);
  return {
    hour: h,
    minutes: m,
    sec: s
  };
};

function initializeVideo() {
  const videoDuration = Math.round(video.duration);
  seek.setAttribute('max', videoDuration);
  progressBar.setAttribute('max', videoDuration);
  const time = formatTime(videoDuration);
  seekTooltip.innerText = `${time.minutes}:${time.sec}`;
  seekTooltip.setAttribute('datetime', `${time.minutes}m ${time.sec}s`)
};

document.addEventListener("DOMContentLoaded", initializeVideo);


function updateProgress() {
  seek.value = Math.floor(video.currentTime);
  progressBar.value = Math.floor(video.currentTime);
};

video.addEventListener('timeupdate', updateProgress);

function updateSeekTooltip(event) {
  const skipTo = Math.round((event.offsetX / event.target.clientWidth) * parseInt(event.target.getAttribute('max'), 10));
  seek.setAttribute('data-seek', skipTo);
  const t = formatTime(skipTo);
  seekTooltip.textContent = `${t.minutes}:${t.sec}`;
  const rect = video.getBoundingClientRect();
  seekTooltip.style.left = `${event.pageX - rect.left}px`;
};

seek.addEventListener('mousemove', updateSeekTooltip);

function skipAhead(event) {
  const skipTo = event.target.dataset.seek ? event.target.dataset.seek : event.target.value;
  video.currentTime = skipTo;
  progressBar.value = skipTo;
  seek.value = skipTo;
};

seek.addEventListener('input', skipAhead);

const volumeButton = document.querySelector('.video__volume');
const volumeIcons = document.querySelectorAll('.video__volume-pic');
const volumeMute = document.querySelector('.volume-mute');
const volumeHigh = document.querySelector('.volume-unmute');
const volume = document.querySelector('.video__volume-scale');

function updateVolume() {
  if (video.muted) {
    video.muted = false;
  }

  video.volume = volume.value;
};

volume.addEventListener('input', updateVolume);

function updateVolumeIcon() {
  volumeIcons.forEach(icon => {
    icon.classList.add('hidden-pic');
  });

  volumeButton.setAttribute('data-title', 'Mute (m)')

  if (video.muted || video.volume === 0) {
    volumeMute.classList.remove('hidden-pic');
    volumeButton.setAttribute('data-title', 'Unmute (m)')
  } else {
    volumeHigh.classList.remove('hidden-pic');
  }
};

video.addEventListener('volumechange', updateVolumeIcon);

function toggleMute() {
  video.muted = !video.muted;

  if (video.muted) {
    volume.setAttribute('data-volume', volume.value);
    volume.value = 0;
  } else {
    volume.value = volume.dataset.volume;
  }
};

volumeButton.addEventListener('click', toggleMute);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZC5qcyIsImJ1cmdlci1tZW51LmpzIiwiZm9ybS5qcyIsIm1haW4uanMiLCJtYXAuanMiLCJvbmVwYWdlLXNjcm9sbC5qcyIsInJldmlld3MuanMiLCJzbGlkZXIuanMiLCJ0ZWFtLmpzIiwidmlkZW8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkN4RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQzNJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBOQVRJVkUgSlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vLyBmdW5jdGlvbiBBY2NvcmQoc2VsZWN0b3IpIHtcclxuLy8gICBjb25zdCBhY2NvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuLy8gICBjb25zdCBpdGVtcyA9IGFjY29yZC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1saXN0XScpLmNoaWxkcmVuO1xyXG4vLyAgIGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjY29yZF9fYnRuJyk7XHJcbiAgXHJcbi8vICAgYWNjb3JkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4vLyAgICAgZS5wcmV2ZW50RGVmYXVsdCAoKTtcclxuLy8gICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ1tkYXRhXScpO1xyXG5cclxuLy8gICAgIGlmKCF0YXJnZXQpIHJldHVybjtcclxuXHJcbi8vICAgICBjb25zdCBpdGVtID0gdGFyZ2V0LnBhcmVudE5vZGU7XHJcbiAgICBcclxuLy8gICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucygnaXRlbS1hY3RpdmUnKSkge1xyXG4vLyAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2l0ZW0tYWN0aXZlJyk7XHJcbi8vICAgICB9ZWxzZSB7XHJcbi8vICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuLy8gICAgICAgICBpdGVtc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdpdGVtLWFjdGl2ZScpO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnaXRlbS1hY3RpdmUnKTtcclxuLy8gICAgIH1cclxuXHJcbi8vICAgICBjbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4vLyAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbi8vICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnaXRlbS1hY3RpdmUnKTtcclxuLy8gICAgIH0pO1xyXG4vLyAgIH0pO1xyXG4vLyB9O1xyXG5cclxuLy8gbmV3IEFjY29yZCAoJyNhY2NvcmQtbWVudScpO1xyXG5cclxuLy8gSlFVRVJZIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuY29uc3QgbWVzdXJlV2lkdGggPSBpdGVtQWMgPT4ge1xyXG5cclxuICAgIGxldCByZXFJdGVtV2lkdGggPSAwO1xyXG4gIFxyXG4gICAgY29uc3Qgc2NyZWVuV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgIGNvbnN0IGNvbnRhaW5lckFjID0gaXRlbUFjLmNsb3Nlc3QoJy5hY2NvcmQnKTtcclxuICAgIGNvbnN0IHRpdGxlQmxvY2tzID0gY29udGFpbmVyQWMuZmluZCgnLmFjY29yZF9fbGluaycpO1xyXG4gICAgXHJcbiAgXHJcbiAgICBjb25zdCB0ZXh0Q29udGFpbmVyID0gaXRlbUFjLmZpbmQoJy5hY2NvcmRfX3RleHQnKTtcclxuICAgIGNvbnN0IHBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoJ3BhZGRpbmctbGVmdCcpKTtcclxuICAgIGNvbnN0IHBhZGRpbmdSaWdodCA9IHBhcnNlSW50KHRleHRDb250YWluZXIuY3NzKCdwYWRkaW5nLXJpZ2h0JykpO1xyXG4gIFxyXG4gICAgY29uc3QgaXNNb2JpbGUgPSB3aW5kb3cubWF0Y2hNZWRpYSgnKG1heC13aWR0aDogNzY4cHgpJykubWF0Y2hlcztcclxuICAgIGNvbnN0IGlzU21hbGxNb2JpbGUgPSB3aW5kb3cubWF0Y2hNZWRpYSgnKG1heC13aWR0aDogNDgwcHgpJykubWF0Y2hlcztcclxuICBcclxuICAgIGNvbnN0IHRpdGxlV2lkdGggPSBpc1NtYWxsTW9iaWxlID8gdGl0bGVCbG9ja3Mud2lkdGgoKSA6IHRpdGxlQmxvY2tzLndpZHRoKCkgKiB0aXRsZUJsb2Nrcy5sZW5ndGg7XHJcbiAgICBpZihpc01vYmlsZSkge1xyXG4gICAgICByZXFJdGVtV2lkdGggPSBzY3JlZW5XaWR0aCAtIHRpdGxlV2lkdGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXFJdGVtV2lkdGggPSA1MDA7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBpZihpc1NtYWxsTW9iaWxlKSB7XHJcbiAgICAgIHJlcUl0ZW1XaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVXaWR0aDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlcUl0ZW1XaWR0aCA9IDUwMDtcclxuICAgIH1cclxuICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGNvbnRhaW5lcjogcmVxSXRlbVdpZHRoLFxyXG4gICAgICB0ZXh0Q29udGFpbmVyOiByZXFJdGVtV2lkdGggLSBwYWRkaW5nTGVmdCAtIHBhZGRpbmdSaWdodFxyXG4gICAgfVxyXG4gIH07XHJcbiAgXHJcbiAgY29uc3QgY2xvc2VJdGVtID0gKGNvbnRhaW5lcikgPT4ge1xyXG4gICAgY29uc3QgaXRlbXNBYyA9IGNvbnRhaW5lci5maW5kKCcuYWNjb3JkX19pdGVtJyk7XHJcbiAgICBjb25zdCBjb250ZW50ID0gY29udGFpbmVyLmZpbmQoJy5hY2NvcmRfX2NvbnRlbnQnKTtcclxuICBcclxuICAgIGl0ZW1zQWMucmVtb3ZlQ2xhc3MoJ2l0ZW0tYWN0aXZlJyk7XHJcbiAgICBjb250ZW50LndpZHRoKDApO1xyXG4gIH1cclxuICBcclxuICBjb25zdCBvcGVuSXRlbSA9IChpdGVtQWMpID0+IHtcclxuICAgIGNvbnN0IGhpZGRlbkNvbnRlbnQgPSBpdGVtQWMuZmluZCgnLmFjY29yZF9fY29udGVudCcpO1xyXG4gICAgY29uc3QgcmVxV2lkdGggPSBtZXN1cmVXaWR0aChpdGVtQWMpO1xyXG4gICAgY29uc3QgdGV4dEJsb2NrID0gaXRlbUFjLmZpbmQoJy5hY2NvcmRfX3RleHQnKTtcclxuICBcclxuICAgIGl0ZW1BYy5hZGRDbGFzcygnaXRlbS1hY3RpdmUnKTtcclxuICAgIGhpZGRlbkNvbnRlbnQud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcclxuICAgIHRleHRCbG9jay53aWR0aChyZXFXaWR0aC50ZXh0Q29udGFpbmVyKTtcclxuICB9O1xyXG4gIFxyXG4gICQoJy5hY2NvcmRfX2xpbmsnKS5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBpdGVtQWMgPSAkdGhpcy5jbG9zZXN0KCcuYWNjb3JkX19pdGVtJyk7XHJcbiAgICBjb25zdCBpdGVtT3BlbmVkID0gaXRlbUFjLmhhc0NsYXNzKCdpdGVtLWFjdGl2ZScpO1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLmFjY29yZCcpO1xyXG4gIFxyXG4gICAgaWYoaXRlbU9wZW5lZCkge1xyXG4gICAgICBjbG9zZUl0ZW0oY29udGFpbmVyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNsb3NlSXRlbShjb250YWluZXIpO1xyXG4gICAgICBvcGVuSXRlbShpdGVtQWMpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG4gICQoJy5hY2NvcmRfX2J0bicpLm9uKCdjbGljaycsIGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgY2xvc2VJdGVtKCQoJy5hY2NvcmQnKSk7XHJcbiAgfSk7IiwiY29uc3QgYnVyZ2VyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J1cmdlcicpO1xyXG5jb25zdCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGFtYnVyZ2VyJyk7XHJcbmNvbnN0IGNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhhbWJ1cmdlcl9fYnRuJyk7XHJcblxyXG5mdW5jdGlvbiBzd2l0Y2hlcihlbGVtLCBjbGFzc05hbWUpIHtcclxuICBlbGVtLmNsYXNzTGlzdC50b2dnbGUoY2xhc3NOYW1lKTtcclxufVxyXG5cclxubGV0IGZsYWcgPSB0cnVlO1xyXG5cclxuYnVyZ2VyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gIGlmKGZsYWcpIHtcclxuICAgIGZsYWcgPSBmYWxzZTtcclxuICAgIGhhbWJ1cmdlci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgIHN3aXRjaGVyKGhhbWJ1cmdlciwgJ2lzQWN0aXZlJyk7XHJcbiAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgfSwgNTAwKTtcclxuICB9XHJcbn0pO1xyXG5cclxuY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIGlmKGZsYWcpIHtcclxuICAgIGZsYWcgPSBmYWxzZTtcclxuICAgIGhhbWJ1cmdlci5jbGFzc0xpc3QucmVtb3ZlKCdpc0FjdGl2ZScpO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgc3dpdGNoZXIoaGFtYnVyZ2VyLCAnaGlkZGVuJyk7XHJcbiAgICAgIGZsYWcgPSB0cnVlO1xyXG4gIH0sIDUwMCk7XHJcbiAgfVxyXG4gIFxyXG59KTsiLCJjb25zdCB2YWxpZGF0ZUZpZWxkcyA9IChmb3JtLCBmaWVsZHNBcnJheSkgPT4ge1xyXG5cclxuICAgIGZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkKSA9PiB7XHJcbiAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKCdpbnB1dC1lcnJvcicpO1xyXG4gICAgICBpZihmaWVsZC52YWwoKS50cmltKCkgPT09ICcnKSB7XHJcbiAgICAgICAgZmllbGQuYWRkQ2xhc3MoJ2lucHV0LWVycm9yJylcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgXHJcbiAgICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZCgnLmlucHV0LWVycm9yJyk7XHJcbiAgXHJcbiAgICByZXR1cm4gZXJyb3JGaWVsZHMubGVuZ3RoID09PSAwO1xyXG4gIH1cclxuICBcclxuICBcclxuICAkKCcuZm9ybScpLnN1Ym1pdChlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICBcclxuICAgIGNvbnN0IGZvcm0gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICAgIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XHJcbiAgICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiW25hbWU9J2NvbW1lbnQnXVwiKTtcclxuICAgIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcbiAgXHJcbiAgICBjb25zdCBwb3B1cCA9ICQoJyNwb3B1cCcpO1xyXG4gICAgY29uc3QgY29udGVudCA9IHBvcHVwLmZpbmQoJy5wb3B1cF9fdGV4dCcpO1xyXG4gICAgcG9wdXAucmVtb3ZlQ2xhc3MoJ2Vycm9yLXBvcHVwJyk7XHJcbiAgXHJcbiAgICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG4gIFxyXG4gICAgaWYgKGlzVmFsaWQpIHtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9ICQuYWpheCh7XHJcbiAgICAgICAgdXJsOidodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWwnLCBcclxuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxyXG4gICAgICAgICAgY29tbWVudDogY29tbWVudC52YWwoKSxcclxuICAgICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yOiBkYXRhID0+IHt9XHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICByZXF1ZXN0LmRvbmUoZGF0YSA9PiB7XHJcbiAgICAgICAgY29udGVudC50ZXh0KGRhdGEubWVzc2FnZSk7XHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICByZXF1ZXN0LmZhaWwoZGF0YSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGRhdGEucmVzcG9uc2VKU09OLm1lc3NhZ2U7XHJcbiAgICAgICAgICBjb250ZW50LnRleHQobWVzc2FnZSk7XHJcbiAgICAgICAgICBwb3B1cC5hZGRDbGFzcygnZXJyb3ItcG9wdXAnKTsgXHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgICAgJC5mYW5jeWJveC5vcGVuKHtcclxuICAgICAgICAgIHNyYzogJyNwb3B1cCcsXHJcbiAgICAgICAgICB0eXBlOiAnaW5saW5lJyxcclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9KTtcclxuICBcclxuICAkKCcuanMtYnRuLXN1Ym1pdCcpLmNsaWNrKGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG4gIH0pO1xyXG4gICIsIi8vIEJVUkdFUiBNRU5VIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHJcblxyXG4vLyBURUFNIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cclxuXHJcbi8vU0xJREVSLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblxyXG5cclxuXHJcbi8vIFJFVklFV1MgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblxyXG4vLyBGT1JNIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHJcbi8vIEFDQ09SRCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cclxuLy8gVklERU8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG5cclxuXHJcbi8vIE1BUCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuXHJcblxyXG4vLyBPTkVQQUdFIFNDUk9MTCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4iLCJmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgY29uc3QgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKCdtYXAnLCB7XHJcbiAgICAgIGNlbnRlcjogWzU1Ljc0OTQxMCwgMzcuNjAxMDYwXSxcclxuICAgICAgem9vbTogMTQsXHJcbiAgICAgIGNvbnRyb2xzOiBbXVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgbXlDb2xsZWN0aW9uID0gbmV3IHltYXBzLkdlb09iamVjdENvbGxlY3Rpb24oe30sIHtcclxuICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcbiAgICAgICAgICBpY29uSW1hZ2VIcmVmOiAnLi9pbWcvaWNvbnMvbWFya2VyLnN2ZycsXHJcbiAgICAgICAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuICAgICAgICAgIGljb25JbWFnZU9mZnNldDogWy0zNSwgLTUyXVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgbXlQb2ludHMgPSBbXHJcbiAgICAgICAgICAgIHsgY29vcmRzOiBbNTUuNzQ5Nzk4LCAzNy42MDU2OTVdLCB0ZXh0OiAnQ0hPQ0NPINCf0LXRgNCy0YvQuSDQvNCw0LPQsNC30LjQvScgfSxcclxuICAgICAgICAgICAgeyBjb29yZHM6IFs1NS43NTg3MjksIDM3LjU4MzE0NV0sIHRleHQ6ICdDSE9DQ08g0JLRgtC+0YDQvtC5INC80LDQs9Cw0LfQuNC9JyB9LFxyXG4gICAgICAgICAgICB7IGNvb3JkczogWzU1Ljc0MjgwNCwgMzcuNTgwNTc2XSwgdGV4dDogJ0NIT0NDTyDQotGA0LXRgtC40Lkg0LzQsNCz0LDQt9C40L0nIH0sXHJcbiAgICAgICAgICAgIHsgY29vcmRzOiBbNTUuNzU3MDY0LCAzNy42MjIxNTddLCB0ZXh0OiAnQ0hPQ0NPINCn0LXRgtCy0LXRgNGC0YvQuSDQvNCw0LPQsNC30LjQvSd9IFxyXG4gICAgICAgIF07XHJcbiAgXHJcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IG15UG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgIGxldCBwb2ludCA9IG15UG9pbnRzW2ldO1xyXG4gICAgICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhcclxuICAgICAgICAgICAgcG9pbnQuY29vcmRzLCB7XHJcbiAgICAgICAgICAgICAgICBiYWxsb29uQ29udGVudEJvZHk6IHBvaW50LnRleHRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICkpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuICBcclxuICAgIGNvbnN0IG15U2VhcmNoQ29udHJvbCA9IG5ldyB5bWFwcy5jb250cm9sLlNlYXJjaENvbnRyb2woe1xyXG4gICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgcHJvdmlkZXI6IG5ldyBDdXN0b21TZWFyY2hQcm92aWRlcihteVBvaW50cyksXHJcbiAgICAgICAgICAgIG5vUGxhY2VtYXJrOiB0cnVlLFxyXG4gICAgICAgICAgICByZXN1bHRzUGVyUGFnZTogNFxyXG4gICAgICAgIH19KTtcclxuICB9XHJcbiAgXHJcbiAgZnVuY3Rpb24gQ3VzdG9tU2VhcmNoUHJvdmlkZXIocG9pbnRzKSB7XHJcbiAgICB0aGlzLnBvaW50cyA9IHBvaW50cztcclxuICB9XHJcbiAgXHJcbiAgXHJcbiAgQ3VzdG9tU2VhcmNoUHJvdmlkZXIucHJvdG90eXBlLmdlb2NvZGUgPSBmdW5jdGlvbiAocmVxdWVzdCwgb3B0aW9ucykge1xyXG4gICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgeW1hcHMudm93LmRlZmVyKCksXHJcbiAgICAgICAgZ2VvT2JqZWN0cyA9IG5ldyB5bWFwcy5HZW9PYmplY3RDb2xsZWN0aW9uKCksXHJcbiAgICAgICAgb2Zmc2V0ID0gb3B0aW9ucy5za2lwIHx8IDAsXHJcbiAgICAgICAgbGltaXQgPSBvcHRpb25zLnJlc3VsdHMgfHwgNDtcclxuICAgICAgICBcclxuICAgIGNvbnN0IHBvaW50cyA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBsZXQgcG9pbnQgPSB0aGlzLnBvaW50c1tpXTtcclxuICAgICAgICBpZiAocG9pbnQudGV4dC50b0xvd2VyQ2FzZSgpLmluZGV4T2YocmVxdWVzdC50b0xvd2VyQ2FzZSgpKSAhPSAtMSkge1xyXG4gICAgICAgICAgICBwb2ludHMucHVzaChwb2ludCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcG9pbnRzID0gcG9pbnRzLnNwbGljZShvZmZzZXQsIGxpbWl0KTtcclxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgIGxldCBwb2ludCA9IHBvaW50c1tpXSxcclxuICAgICAgICAgICAgY29vcmRzID0gcG9pbnQuY29vcmRzLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBwb2ludC50ZXh0O1xyXG4gIFxyXG4gICAgICAgIGdlb09iamVjdHMuYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoY29vcmRzLCB7XHJcbiAgICAgICAgICAgIG5hbWU6IHRleHQgKyAnIG5hbWUnLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogdGV4dCArICcgZGVzY3JpcHRpb24nLFxyXG4gICAgICAgICAgICBiYWxsb29uQ29udGVudEJvZHk6ICc8cD4nICsgdGV4dCArICc8L3A+JyxcclxuICAgICAgICAgICAgYm91bmRlZEJ5OiBbY29vcmRzLCBjb29yZHNdXHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgZGVmZXJyZWQucmVzb2x2ZSh7XHJcbiAgICAgICAgZ2VvT2JqZWN0czogZ2VvT2JqZWN0cyxcclxuICAgICAgICBtZXRhRGF0YToge1xyXG4gICAgICAgICAgICBnZW9jb2Rlcjoge1xyXG4gICAgICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdCxcclxuICAgICAgICAgICAgICAgIGZvdW5kOiBnZW9PYmplY3RzLmdldExlbmd0aCgpLFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0czogbGltaXQsXHJcbiAgICAgICAgICAgICAgICBza2lwOiBvZmZzZXRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gIFxyXG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcclxuICB9O1xyXG4gIFxyXG4gIHltYXBzLnJlYWR5KGluaXQpOyIsImNvbnN0IHNlY3Rpb25zID0gJCgnc2VjdGlvbicpO1xyXG5jb25zdCBkaXNwbGF5ID0gJCgnLm1haW5jb250ZW50Jyk7XHJcbmNvbnN0IHNpZGVNZW51ID0gJCgnLmRvdHMtbWVudScpO1xyXG5jb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKCcuZG90cy1tZW51X19pdGVtJyk7XHJcblxyXG5jb25zdCBtb2JpbGVEZXRlY3QgPSBuZXcgTW9iaWxlRGV0ZWN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcclxuY29uc3QgaXNNb2JpbGUgPSBtb2JpbGVEZXRlY3QubW9iaWxlKCk7XHJcblxyXG5sZXQgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbnNlY3Rpb25zLmZpcnN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZS1zZWN0Jyk7XHJcblxyXG5jb25zdCBjb3VudFNlY3Rpb24gPSAoc2VjdGlvbkVxKSA9PiB7XHJcbiAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xyXG4gIFxyXG4gIGlmKGlzTmFOKHBvc2l0aW9uKSkge1xyXG4gICAgY29uc29sZS5lcnJvcignaW5jb3JyZWN0IHZhbHVlIGluIGNvdW50U2VjdGlvbicpO1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG4gIHJldHVybiBwb3NpdGlvbjtcclxufVxyXG5cclxuY29uc3QgY2hhbmdlTWVudUNvbG9yID0gc2VjdGlvbkVxID0+IHtcclxuICAgICAgY29uc3QgY3VycmVudFNlY3Rpb24gPSBzZWN0aW9ucy5lcShzZWN0aW9uRXEpO1xyXG4gICAgICBjb25zdCBtZW51Q29sb3IgPSBjdXJyZW50U2VjdGlvbi5hdHRyKCdkYXRhLWRvdHNtZW51LWNvbG9yJyk7XHJcbiAgICAgIGNvbnN0IGFjdGl2ZUNsYXNzID0gJ2RvdHMtbWVudS0tZGFyayc7XHJcblxyXG4gICAgICBpZihtZW51Q29sb3IgPT09ICdkYXJrJykge1xyXG4gICAgICAgIHNpZGVNZW51LmFkZENsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICAgIH1cclxufTtcclxuXHJcbmNvbnN0IHJlc2V0QWN0aXZlQ2xhc3MgPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICBpdGVtcy5lcShpdGVtRXEpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IHBlcmZvcm1UcmFucyA9IChzZWN0aW9uRXEpID0+IHtcclxuXHJcbiAgaWYoaW5TY3JvbGwpIHJldHVybjtcclxuXHJcbiAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xyXG4gIGNvbnN0IG1vdXNlT3ZlciA9IDMwMDtcclxuXHJcbiAgICBpblNjcm9sbCA9IHRydWU7XHJcblxyXG4gICAgY29uc3QgcG9zaXRpb24gPSBjb3VudFNlY3Rpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgICBjaGFuZ2VNZW51Q29sb3Ioc2VjdGlvbkVxKTtcclxuXHJcbiAgICBkaXNwbGF5LmNzcyh7XHJcbiAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0lKWBcclxuICAgIH0pO1xyXG5cclxuICAgIHJlc2V0QWN0aXZlQ2xhc3Moc2VjdGlvbnMsIHNlY3Rpb25FcSwgJ2FjdGl2ZS1zZWN0Jyk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGluU2Nyb2xsID0gZmFsc2U7XHJcbiAgICAgIHJlc2V0QWN0aXZlQ2xhc3MobWVudUl0ZW1zLCBzZWN0aW9uRXEsICdkb3RzLW1lbnVfX2l0ZW0tLWFjdGl2ZScpO1xyXG4gICAgfSwgdHJhbnNpdGlvbk92ZXIgKyBtb3VzZU92ZXIpO1xyXG59O1xyXG5cclxuY29uc3Qgc2Nyb2xsID0gKCkgPT4ge1xyXG4gIGNvbnN0IGFjdGl2ZVNlY3Rpb24gPSBzZWN0aW9ucy5maWx0ZXIoJy5hY3RpdmUtc2VjdCcpO1xyXG4gIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG5leHQoKSB7XHJcbiAgICAgIGlmKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFucyhuZXh0U2VjdGlvbi5pbmRleCgpKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHByZXYoKSB7XHJcbiAgICAgIGlmKHByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFucyhwcmV2U2VjdGlvbi5pbmRleCgpKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICB9O1xyXG59O1xyXG5cclxuJCh3aW5kb3cpLm9uKCd3aGVlbCcsIGUgPT4ge1xyXG4gIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbiAgY29uc3Qgc2Nyb2xsZXIgPSBzY3JvbGwoKTtcclxuXHJcbiAgaWYgKGRlbHRhWSA+IDApIHtcclxuICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICB9XHJcbiAgXHJcbiAgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICB9XHJcbn0pO1xyXG5cclxuJCh3aW5kb3cpLm9uKCdrZXlkb3duJywgZSA9PiB7XHJcbiAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICBjb25zdCB0eXBpbmdJbnB1dHMgPSB0YWdOYW1lID09PSdpbnB1dCcgfHwgdGFnTmFtZSA9PT0gJ3RleHRhcmVhJztcclxuICBjb25zdCBzY3JvbGxlciA9IHNjcm9sbCgpO1xyXG5cclxuICBpZiAodHlwaW5nSW5wdXRzKSByZXR1cm47XHJcblxyXG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgY2FzZSAzODpcclxuICAgICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICAgIGJyZWFrO1xyXG4gIFxyXG4gICAgICBjYXNlIDQwOlxyXG4gICAgICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuJCgnLndyYXBwZXInKS5vbigndG91Y2htb3ZlJywgZSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xyXG5cclxuJCgnW2RhdGEtc2Nyb2xsLXRvXScpLmNsaWNrKGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cignZGF0YS1zY3JvbGwtdG8nKTtcclxuICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZD0ke3RhcmdldH1dYCk7XHJcbiAgJCgnLmhhbWJ1cmdlcicpLmFkZENsYXNzKCdoaWRkZW4nKTtcclxuXHJcbiAgcGVyZm9ybVRyYW5zKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbn0pO1xyXG5cclxuLy8gUEhPTkVTIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbmlmIChpc01vYmlsZSkge1xyXG4gICQoJ2JvZHknKS5zd2lwZSh7XHJcbiAgICBzd2lwZTogZnVuY3Rpb24oZXZlbnQsIGRpcmVjdGlvbikge1xyXG4gICAgICBjb25zdCBzY3JvbGxlciA9IHNjcm9sbCgpO1xyXG4gICAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gJyc7XHJcbiAgXHJcbiAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd1cCcpIHNjcm9sbERpcmVjdGlvbiA9ICduZXh0JztcclxuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSBzY3JvbGxEaXJlY3Rpb24gPSAncHJldic7XHJcbiAgICAgIFxyXG4gICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbiAgICB9LFxyXG4gIH0pO1xyXG59OyIsIi8vIEpRdWVycnkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy8gY29uc3QgZmluZEJsb2NrQnlBbGlhcyA9IChhbGlhcykgPT4ge1xyXG4vLyAgIHJldHVybiAkKCcucmV2aWV3X19jb250YWluZXInKS5maWx0ZXIoKG5keCwgaXRlbSkgPT4ge1xyXG4vLyAgICAgcmV0dXJuICQoaXRlbSkuYXR0cignZGF0YS1saW5rZWQtd2l0aCcpID09IGFsaWFzO1xyXG4vLyAgIH0pO1xyXG4vLyB9O1xyXG5cclxuLy8gJCgnLmF2YXRhci1tZW51X19saW5rJykuY2xpY2soKGUpID0+IHtcclxuLy8gICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4vLyAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4vLyAgIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoJ2RhdGEtb3BlbicpO1xyXG4vLyAgIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbi8vICAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoJy5hdmF0YXItbWVudScpO1xyXG5cclxuLy8gICBpdGVtVG9TaG93LmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuLy8gICBjdXJJdGVtLmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuLy8gfSk7XHJcblxyXG4vLyBOQVRJVkUgSlMvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuY29uc3QgcmV2aWV3QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmF2YXRhci1tZW51Jyk7XHJcbmNvbnN0IHJldmlld1RhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmV2aWV3X19jb250YWluZXInKTtcclxuXHJcbmZvciAobGV0IGk9MDsgaTxyZXZpZXdCdG4ubGVuZ3RoOyBpKyspIHtcclxuICByZXZpZXdCdG5baV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgZm9yIChsZXQgaW5kZXg9MDsgaW5kZXg8cmV2aWV3QnRuLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICByZXZpZXdCdG5baW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpXHJcbiAgICAgIHJldmlld1RhYnNbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUgKCdhY3RpdmUnKVxyXG4gICAgfTtcclxuICAgIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgIHJldmlld1RhYnNbaV0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgfSk7XHJcbn0iLCJjb25zdCBzbGlkZXIgPSAkKCcuZ29vZHMtbGlzdCcpLmJ4U2xpZGVyKHtcclxuICAgIHBhZ2VyOiBmYWxzZSxcclxuICAgIGNvbnRyb2xzOiBmYWxzZVxyXG4gIH0pO1xyXG4gIFxyXG4gICQoJy5hcnJvd19fbGluay0tbGVmdCcpLmNsaWNrKGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgc2xpZGVyLmdvVG9QcmV2U2xpZGUoKTtcclxuICB9KVxyXG4gIFxyXG4gICQoJy5hcnJvd19fbGluay0tcmlnaHQnKS5jbGljayhlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIHNsaWRlci5nb1RvTmV4dFNsaWRlKCk7XHJcbiAgfSkiLCJjb25zdCB0ZWFtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlYW0nKTtcclxuY29uc3QgdGVhbUxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGVhbV9fbGluaycpO1xyXG5cclxudGVhbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBsaW5rID0gZS50YXJnZXQ7XHJcbiAgY29uc3QgbGlzdEl0ZW0gPSBlLmN1cnJlbnRUYXJnZXQ7XHJcblxyXG4gIGlmKGxpbmsuY2xhc3NMaXN0LmNvbnRhaW5zKCd0ZWFtX19saW5rJykpIHtcclxuICAgIGNvbnN0IGFjdGl2ZSA9IGxpc3RJdGVtLnF1ZXJ5U2VsZWN0b3IoJy50ZWFtX19pdGVtLnRlYW1fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgY29uc29sZS5sb2coYWN0aXZlKTtcclxuXHJcbiAgICBpZihhY3RpdmUpIHtcclxuICAgICAgbGV0IGFjdGl2ZUluZm8gPSBhY3RpdmUucXVlcnlTZWxlY3RvcignLnRlYW1fX2luZm8nKTtcclxuICAgICAgYWN0aXZlSW5mby5zdHlsZS5oZWlnaHQgPSAnMHB4JztcclxuICAgICAgYWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoJ3RlYW1fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKCFhY3RpdmUgfHwgYWN0aXZlLnF1ZXJ5U2VsZWN0b3IoJy50ZWFtX19saW5rJykgIT09IGxpbmspIHtcclxuICAgICAgICAgICAgICBsZXQgY3VycmVudCA9IGxpbmsuY2xvc2VzdCgnLnRlYW1fX2l0ZW0nKTtcclxuICAgICAgICAgICAgICBjdXJyZW50LmNsYXNzTGlzdC5hZGQoJ3RlYW1fX2l0ZW0tLWlzLWFjdGl2ZScpO1xyXG4gICAgICAgICAgICAgIGxldCBjdXJyZW50VGV4dCA9IGN1cnJlbnQucXVlcnlTZWxlY3RvcignLnRlYW1fX2luZm8nKTtcclxuICAgICAgICAgICAgICBjdXJyZW50VGV4dC5zdHlsZS5oZWlnaHQgPSBjdXJyZW50VGV4dC5zY3JvbGxIZWlnaHQgKyAncHgnO1xyXG4gIH1cclxufVxyXG59KTsiLCJjb25zdCBwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3BsYXllcicpO1xyXG5jb25zdCB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fbXA0Jyk7XHJcbmNvbnN0IGp1aWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX19wbGF5YmFjay1idG4nKTtcclxuY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5LXBhdXNlJyk7XHJcbmNvbnN0IHNlZWtUb29sdGlwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlZWstdG9vbHRpcCcpO1xyXG5cclxuY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3MtYmFyJyk7XHJcbmNvbnN0IHNlZWsgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VlaycpO1xyXG5cclxuXHJcblxyXG5mdW5jdGlvbiB0b2dnbGVQbGF5UGF1c2UoKSB7XHJcbiAgaWYodmlkZW8ucGF1c2VkKSB7XHJcbiAgICBwbGF5QnRuLmNsYXNzTmFtZSA9ICdwYXVzZSc7XHJcbiAgICB2aWRlby5wbGF5KCk7XHJcbiAgfVxyXG4gIGVsc2Uge1xyXG4gICAgcGxheUJ0bi5jbGFzc05hbWUgPSAncGxheSc7XHJcbiAgICB2aWRlby5wYXVzZSgpO1xyXG4gIH1cclxufTtcclxuXHJcbnBsYXlCdG4ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICB0b2dnbGVQbGF5UGF1c2UoKTtcclxufTtcclxuXHJcbnBsYXllci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVBsYXlQYXVzZSk7XHJcblxyXG5mdW5jdGlvbiBmb3JtYXRUaW1lKHNlY29uZHMpIHtcclxuICBjb25zdCBoID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7XHJcbiAgY29uc3QgbSA9IE1hdGguZmxvb3IoKHNlY29uZHMgJSAzNjAwKSAvIDYwKTtcclxuICBjb25zdCBzID0gTWF0aC5yb3VuZChzZWNvbmRzICUgNjApO1xyXG4gIHJldHVybiB7XHJcbiAgICBob3VyOiBoLFxyXG4gICAgbWludXRlczogbSxcclxuICAgIHNlYzogc1xyXG4gIH07XHJcbn07XHJcblxyXG5mdW5jdGlvbiBpbml0aWFsaXplVmlkZW8oKSB7XHJcbiAgY29uc3QgdmlkZW9EdXJhdGlvbiA9IE1hdGgucm91bmQodmlkZW8uZHVyYXRpb24pO1xyXG4gIHNlZWsuc2V0QXR0cmlidXRlKCdtYXgnLCB2aWRlb0R1cmF0aW9uKTtcclxuICBwcm9ncmVzc0Jhci5zZXRBdHRyaWJ1dGUoJ21heCcsIHZpZGVvRHVyYXRpb24pO1xyXG4gIGNvbnN0IHRpbWUgPSBmb3JtYXRUaW1lKHZpZGVvRHVyYXRpb24pO1xyXG4gIHNlZWtUb29sdGlwLmlubmVyVGV4dCA9IGAke3RpbWUubWludXRlc306JHt0aW1lLnNlY31gO1xyXG4gIHNlZWtUb29sdGlwLnNldEF0dHJpYnV0ZSgnZGF0ZXRpbWUnLCBgJHt0aW1lLm1pbnV0ZXN9bSAke3RpbWUuc2VjfXNgKVxyXG59O1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgaW5pdGlhbGl6ZVZpZGVvKTtcclxuXHJcblxyXG5mdW5jdGlvbiB1cGRhdGVQcm9ncmVzcygpIHtcclxuICBzZWVrLnZhbHVlID0gTWF0aC5mbG9vcih2aWRlby5jdXJyZW50VGltZSk7XHJcbiAgcHJvZ3Jlc3NCYXIudmFsdWUgPSBNYXRoLmZsb29yKHZpZGVvLmN1cnJlbnRUaW1lKTtcclxufTtcclxuXHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCB1cGRhdGVQcm9ncmVzcyk7XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVTZWVrVG9vbHRpcChldmVudCkge1xyXG4gIGNvbnN0IHNraXBUbyA9IE1hdGgucm91bmQoKGV2ZW50Lm9mZnNldFggLyBldmVudC50YXJnZXQuY2xpZW50V2lkdGgpICogcGFyc2VJbnQoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgnbWF4JyksIDEwKSk7XHJcbiAgc2Vlay5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2VlaycsIHNraXBUbyk7XHJcbiAgY29uc3QgdCA9IGZvcm1hdFRpbWUoc2tpcFRvKTtcclxuICBzZWVrVG9vbHRpcC50ZXh0Q29udGVudCA9IGAke3QubWludXRlc306JHt0LnNlY31gO1xyXG4gIGNvbnN0IHJlY3QgPSB2aWRlby5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICBzZWVrVG9vbHRpcC5zdHlsZS5sZWZ0ID0gYCR7ZXZlbnQucGFnZVggLSByZWN0LmxlZnR9cHhgO1xyXG59O1xyXG5cclxuc2Vlay5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB1cGRhdGVTZWVrVG9vbHRpcCk7XHJcblxyXG5mdW5jdGlvbiBza2lwQWhlYWQoZXZlbnQpIHtcclxuICBjb25zdCBza2lwVG8gPSBldmVudC50YXJnZXQuZGF0YXNldC5zZWVrID8gZXZlbnQudGFyZ2V0LmRhdGFzZXQuc2VlayA6IGV2ZW50LnRhcmdldC52YWx1ZTtcclxuICB2aWRlby5jdXJyZW50VGltZSA9IHNraXBUbztcclxuICBwcm9ncmVzc0Jhci52YWx1ZSA9IHNraXBUbztcclxuICBzZWVrLnZhbHVlID0gc2tpcFRvO1xyXG59O1xyXG5cclxuc2Vlay5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHNraXBBaGVhZCk7XHJcblxyXG5jb25zdCB2b2x1bWVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3ZvbHVtZScpO1xyXG5jb25zdCB2b2x1bWVJY29ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy52aWRlb19fdm9sdW1lLXBpYycpO1xyXG5jb25zdCB2b2x1bWVNdXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZvbHVtZS1tdXRlJyk7XHJcbmNvbnN0IHZvbHVtZUhpZ2ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudm9sdW1lLXVubXV0ZScpO1xyXG5jb25zdCB2b2x1bWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3ZvbHVtZS1zY2FsZScpO1xyXG5cclxuZnVuY3Rpb24gdXBkYXRlVm9sdW1lKCkge1xyXG4gIGlmICh2aWRlby5tdXRlZCkge1xyXG4gICAgdmlkZW8ubXV0ZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHZpZGVvLnZvbHVtZSA9IHZvbHVtZS52YWx1ZTtcclxufTtcclxuXHJcbnZvbHVtZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZVZvbHVtZSk7XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVWb2x1bWVJY29uKCkge1xyXG4gIHZvbHVtZUljb25zLmZvckVhY2goaWNvbiA9PiB7XHJcbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbi1waWMnKTtcclxuICB9KTtcclxuXHJcbiAgdm9sdW1lQnV0dG9uLnNldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScsICdNdXRlIChtKScpXHJcblxyXG4gIGlmICh2aWRlby5tdXRlZCB8fCB2aWRlby52b2x1bWUgPT09IDApIHtcclxuICAgIHZvbHVtZU11dGUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuLXBpYycpO1xyXG4gICAgdm9sdW1lQnV0dG9uLnNldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScsICdVbm11dGUgKG0pJylcclxuICB9IGVsc2Uge1xyXG4gICAgdm9sdW1lSGlnaC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4tcGljJyk7XHJcbiAgfVxyXG59O1xyXG5cclxudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigndm9sdW1lY2hhbmdlJywgdXBkYXRlVm9sdW1lSWNvbik7XHJcblxyXG5mdW5jdGlvbiB0b2dnbGVNdXRlKCkge1xyXG4gIHZpZGVvLm11dGVkID0gIXZpZGVvLm11dGVkO1xyXG5cclxuICBpZiAodmlkZW8ubXV0ZWQpIHtcclxuICAgIHZvbHVtZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdm9sdW1lJywgdm9sdW1lLnZhbHVlKTtcclxuICAgIHZvbHVtZS52YWx1ZSA9IDA7XHJcbiAgfSBlbHNlIHtcclxuICAgIHZvbHVtZS52YWx1ZSA9IHZvbHVtZS5kYXRhc2V0LnZvbHVtZTtcclxuICB9XHJcbn07XHJcblxyXG52b2x1bWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVNdXRlKTsiXX0=
